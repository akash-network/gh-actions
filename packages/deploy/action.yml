name: 'Deploy on Akash Network'
description: 'Deploy applications on Akash Network using the Chain SDK'
author: 'Akash Network Team'

branding:
  icon: 'cloud'
  color: 'red'

inputs:
  mnemonic:
    description: 'Wallet mnemonic phrase for signing transactions. Should be stored as a GitHub secret.'
    required: true

  bid-filter:
    description: |
      Filter for selecting a bid from providers using @ucast/mongo2js syntax.
      Examples:
        - '{ "provider": "akash1..." }'
        - '{ "price.amount": { "$lte": "1000" } }'
    required: false

  pick-bid-strategy:
    description: |
      Strategy for picking a bid.
      Examples:
        - 'cheapest'
        - 'first'
    required: false
    default: 'cheapest'

  sdl:
    description: |
      SDL (Stack Definition Language) for the deployment.
      Can be either:
        - A path to an SDL file (e.g., './deploy.yaml')
        - An inline SDL string
    required: true

  gas:
    description: 'Gas limit for transactions'
    required: false
    default: 'auto'

  gas-multiplier:
    description: 'Gas multiplier (used when gas is "auto")'
    required: false
    default: '1.5'

  fee:
    description: 'Fee amount in the smallest denomination'
    required: false
    default: ''

  denom:
    description: 'Token denomination for fees and deposit'
    required: false
    default: 'uakt'

  deposit:
    description: 'Deposit amount for the deployment in uakt'
    required: false
    default: '500000'

  rest-url:
    description: 'REST API URL for querying the Akash network'
    required: false
    default: 'https://rpc.akt.dev/rest'

  tx-rpc-url:
    description: 'RPC URL for submitting transactions'
    required: false
    default: 'https://rpc.akt.dev/rpc'

  lease-timeout:
    description: 'Maximum time to wait for bids and lease creation (in seconds)'
    required: false
    default: '180'

  deployment-details-path:
    description: |
      Path to a JSON file used for storing and reading deployment details.
      If the file exists, the action reads it and reuses the deployment (or creates a new one if the lease has closed).
      After any new deployment, the file is written with the latest dseq and lease details.
    required: false

outputs:
  deployment-id:
    description: 'The deployment ID (owner/dseq)'

  dseq:
    description: 'The deployment sequence number'

  lease-id:
    description: 'The lease ID (owner/dseq/gseq/oseq/provider)'

  provider:
    description: 'The selected provider address'

  lease-status:
    description: 'The status of the lease'

  is-new:
    description: 'Indicates if this deployment was a fresh new deployment or a redeployment (true/false)'

  prev-dseq:
    description: 'The previous deployment sequence number, set only when is-new is true and deployment-details-path was provided (i.e. the old lease was closed and a new deployment was created)'

runs:
  using: 'node24'
  main: 'dist/index.js'
